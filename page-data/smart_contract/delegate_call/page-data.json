{
    "componentChunkName": "component---src-templates-blog-template-js",
    "path": "/smart_contract/delegate_call/",
    "result": {"data":{"cur":{"id":"e453ebaa-285a-5ed3-b3a7-22d4d4def40d","html":"<h1 id=\"-delegatecall\" style=\"position:relative;\"><a href=\"#-delegatecall\" aria-label=\" delegatecall permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>👋 DelegateCall</h1>\n<h2 id=\"들어가기전-call-과-delegate-call의-차이점\" style=\"position:relative;\"><a href=\"#%EB%93%A4%EC%96%B4%EA%B0%80%EA%B8%B0%EC%A0%84-call-%EA%B3%BC-delegate-call%EC%9D%98-%EC%B0%A8%EC%9D%B4%EC%A0%90\" aria-label=\"들어가기전 call 과 delegate call의 차이점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>들어가기전 Call 과 Delegate Call의 차이점</h2>\n<h4 id=\"call이란\" style=\"position:relative;\"><a href=\"#call%EC%9D%B4%EB%9E%80\" aria-label=\"call이란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Call이란?</h4>\n<p>Call은 다른 contract와 상호작용하기 위한 low level function이다.</p>\n<p>컨트랙트 A를 통해 컨트랙트 B의 함수 호출시 B의 Storage를 변경시키며 msg.sender(호출자)는 컨트랙트A의 주소가 됩니다.</p>\n<h4 id=\"delegate-call이란\" style=\"position:relative;\"><a href=\"#delegate-call%EC%9D%B4%EB%9E%80\" aria-label=\"delegate call이란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Delegate Call이란?</h4>\n<p>delegate call은 call과 매우 유사하다. delegate은 ‘위임하다’ 라는 뜻으로 call에 대한 권한을 위임한다고 볼 수 있다.</p>\n<p>Delegate Call에는 2가지 특징이 있다.</p>\n<ol>\n<li>호출한 contract의 context를 기반으로 동작된다.</li>\n<li>storage layout은 delegatecall을 이용하는 contract와 같아야한다.</li>\n</ol>\n<p>예를 들어 컨트랙트 A를 통해 컨트랙트 B 호출시 B의 Storage를 변경시키지 않고, B의 코드를 A에서 실행합니다. msg.sender와 msg.value가 컨트랙트 A 호출시와 같고, 변동되지 않습니다.</p>\n<p>만약 delegate call에 대해 방지하지 않는다면 contract의 내용을 hacker가 마음대로 조종 할 수 있게 될수도 있다. EX) owner변경, ether 가로채기 등등</p>\n<hr>\n<h2 id=\"example-code-1\" style=\"position:relative;\"><a href=\"#example-code-1\" aria-label=\"example code 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Example Code 1</h2>\n<div class=\"gatsby-highlight\" data-language=\"solidity\"><pre class=\"language-solidity\"><code class=\"language-solidity\"><span class=\"token keyword\">contract</span> <span class=\"token class-name\">Lib</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token builtin\">address</span> <span class=\"token keyword\">public</span> owner<span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">function</span> <span class=\"token function\">pwn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">public</span> <span class=\"token punctuation\">{</span>\r\n        owner <span class=\"token operator\">=</span> msg<span class=\"token punctuation\">.</span>sender<span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token keyword\">contract</span> <span class=\"token class-name\">HackMe</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token builtin\">address</span> <span class=\"token keyword\">public</span> owner<span class=\"token punctuation\">;</span>\r\n    Lib <span class=\"token keyword\">public</span> lib<span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">constructor</span><span class=\"token punctuation\">(</span>Lib _lib<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        owner <span class=\"token operator\">=</span> msg<span class=\"token punctuation\">.</span>sender<span class=\"token punctuation\">;</span>\r\n        lib <span class=\"token operator\">=</span> <span class=\"token function\">Lib</span><span class=\"token punctuation\">(</span>_lib<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token function\">fallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">external</span> <span class=\"token keyword\">payable</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token builtin\">address</span><span class=\"token punctuation\">(</span>lib<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">delegatecall</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token keyword\">contract</span> <span class=\"token class-name\">Attack</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token builtin\">address</span> <span class=\"token keyword\">public</span> hackMe<span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">address</span> _hackMe<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        hackMe <span class=\"token operator\">=</span> _hackMe<span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token keyword\">function</span> <span class=\"token function\">attack</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">public</span> <span class=\"token punctuation\">{</span>\r\n        hackMe<span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span>abi<span class=\"token punctuation\">.</span><span class=\"token function\">encodeWithSignature</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"pwn()\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><span style=\"color:grey\">출처: <a href=\"https://solidity-by-example.org/hacks/delegatecall/\">https://solidity-by-example.org/hacks/delegatecall/</a> </span></p>\n<p>시나리오는 이렇다.</p>\n<ol>\n<li>A가 Lib contract 배포</li>\n<li>A가 Lib의 address를 포함한 HackMe contract 배포</li>\n<li><strong>Hacker</strong> 가 HackMe의 address를 포함한 Attack contract 배포</li>\n<li><strong>Hacker</strong> 가 Attack.attack()을 call</li>\n<li>HackMe contract의 owner는 Attack contract가 된다.</li>\n</ol>\n<p>좀 더 자세히 들여다보겠다.\r\n<strong>Hacker</strong> 가 Attack.attack를 call하게 되면 HackMe contract의 fallback function이 실행된다. Fallback function에는 lib를 쓰기 위한 Delegate Call이 존재한다. Attack.attack에서 “pwn()“을 보냈기 때문에 Lib contract의 pwn이 실행된다.\r\n이때 delegate call로 call하였기 때문에 msg.sender은 Attack contract가 된다. 이렇게되면 Attack contract가 HackMe의 주인이 된다.</p>\n<hr>\n<h2 id=\"how-to-prevent\" style=\"position:relative;\"><a href=\"#how-to-prevent\" aria-label=\"how to prevent permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>How to prevent?</h2>\n<ol>\n<li><strong>library</strong> 키워드를 사용한다.\r\nlibrary 키워드를 사용함으로써 stateless하고 self destruct를 방지 할 수 있다.</li>\n<li>가능하다면 stateless 라이브러리를 사용한다.\r\n위와 마찬가지로 stateless하다면 바꿀 state가 없기 때문에 더 안전해질 수 있다.</li>\n</ol>\n<hr>\n<h2 id=\"마무리\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EB%AC%B4%EB%A6%AC\" aria-label=\"마무리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>마무리</h2>\n<p>나에게 Delegate call은 생각보다 개념이 어려웠다. Example code와 다른 example들을 통해 실습하면서 개념을 얻을 것 같다. 한편으로 이게 어려우면 다른건 어째하냐~~ 라는 생각이들지만 그때마다 실습하지 뭐!! 실습 짱!!</p>\n<hr>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%EB%93%A4%EC%96%B4%EA%B0%80%EA%B8%B0%EC%A0%84-call-%EA%B3%BC-delegate-call%EC%9D%98-%EC%B0%A8%EC%9D%B4%EC%A0%90\">들어가기전 Call 과 Delegate Call의 차이점</a></p>\n<ul>\n<li>\n<ul>\n<li><a href=\"#call%EC%9D%B4%EB%9E%80\">Call이란?</a></li>\n<li><a href=\"#delegate-call%EC%9D%B4%EB%9E%80\">Delegate Call이란?</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#example-code-1\">Example Code 1</a></p>\n</li>\n<li>\n<p><a href=\"#how-to-prevent\">How to prevent?</a></p>\n</li>\n<li>\n<p><a href=\"#%EB%A7%88%EB%AC%B4%EB%A6%AC\">마무리</a></p>\n</li>\n</ul>\n</div>","excerpt":"👋 DelegateCall 들어가기전 Call 과 Delegate Call의 차이점 Call이란? Call은 다른 contract와 상호작용하기 위한 low level function이다. 컨트랙트 A를 통해 컨트랙트 B의 함수 호출시 B의 Storage를 변경시키며 msg.sender(호출자)는 컨트랙트A의 주소가 됩니다. Delegate Call이란? delegate call은 call과 매우 유사하다. delegate은 ‘위임하다’ 라는 뜻으로 call에 대한 권한을 위임한다고 볼 수 있다. Delegate Call에는 2가지 특징이 있다. 호출한 contract의 context를 기반으로 동작된다. storage layout은 delegatecall을 이용하는 contract와 같아야한다. 예를 들어 컨트랙트 A를 통해 컨트랙트 B 호출시 B의 Storage를 변경시키지 않고, B의 코드를 A에서 실행합니다. msg.sender와 msg.value가 컨트랙트 A 호출시와 같…","frontmatter":{"date":"December 26, 2021","title":"(취약점 시리즈 4) Delegate Call","categories":"취약점분석","author":"한성원","emoji":"🧢"},"fields":{"slug":"/smart_contract/delegate_call/"}},"next":{"id":"5f7f9e3c-6802-5000-9596-6c2e78ad5ff6","html":"<h1 id=\"-blocktimestamp\" style=\"position:relative;\"><a href=\"#-blocktimestamp\" aria-label=\" blocktimestamp permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>👋 block.timestamp</h1>\n<h2 id=\"blocktimestamp란\" style=\"position:relative;\"><a href=\"#blocktimestamp%EB%9E%80\" aria-label=\"blocktimestamp란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>block.timestamp란?</h2>\n<p>block.timestamp는 msg.sender처럼 블록체인에서 제공해주는 global 변수 중 하나이다. 이는 블록 생성 시간을 나타낸다.\r\n블록체인의 timestamp는 생성 시점에 데이터가 존재했다는 사실을 증명해주기 때문에 블록체인 자체에 매우 중요하다.</p>\n<hr>\n<h2 id=\"왜-취약점-시리즈에-들어갔을까\" style=\"position:relative;\"><a href=\"#%EC%99%9C-%EC%B7%A8%EC%95%BD%EC%A0%90-%EC%8B%9C%EB%A6%AC%EC%A6%88%EC%97%90-%EB%93%A4%EC%96%B4%EA%B0%94%EC%9D%84%EA%B9%8C\" aria-label=\"왜 취약점 시리즈에 들어갔을까 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>왜 취약점 시리즈에 들어갔을까?</h2>\n<p>바로 block.timestamp는 채굴자(miner)들에게 영향을 받을 수 있기 때문이다. 즉 block.timestamp를 통해 random을 생성하거나 block.timestamp와 관련해서 접근할 수 있는 함수가 있다면 smart contract에게 좋지 않은 영향을 끼칠 수 있다.</p>\n<hr>\n<h2 id=\"example-code\" style=\"position:relative;\"><a href=\"#example-code\" aria-label=\"example code permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Example code</h2>\n<div class=\"gatsby-highlight\" data-language=\"solidity\"><pre class=\"language-solidity\"><code class=\"language-solidity\"><span class=\"token keyword\">contract</span> <span class=\"token class-name\">Roulette</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token builtin\">uint</span> <span class=\"token keyword\">public</span> pastBlockTime<span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">payable</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token keyword\">function</span> <span class=\"token function\">spin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">external</span> <span class=\"token keyword\">payable</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">.</span>value <span class=\"token operator\">==</span> <span class=\"token number\">10</span> ether<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// must send 10 ether to play</span>\r\n        <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span>block<span class=\"token punctuation\">.</span>timestamp <span class=\"token operator\">!=</span> pastBlockTime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// only 1 transaction per block</span>\r\n\r\n        pastBlockTime <span class=\"token operator\">=</span> block<span class=\"token punctuation\">.</span>timestamp<span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>block<span class=\"token punctuation\">.</span>timestamp <span class=\"token operator\">%</span> <span class=\"token number\">15</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n            <span class=\"token punctuation\">(</span><span class=\"token builtin\">bool</span> sent<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> msg<span class=\"token punctuation\">.</span>sender<span class=\"token punctuation\">.</span>call<span class=\"token punctuation\">{</span>value<span class=\"token punctuation\">:</span> <span class=\"token builtin\">address</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>balance<span class=\"token punctuation\">}</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span>sent<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Failed to send Ether\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n    <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><span style=\"color:grey\">출처: <a href=\"https://solidity-by-example.org/hacks/block-timestamp-manipulation/\">https://solidity-by-example.org/hacks/block-timestamp-manipulation/</a></span></p>\n<p>위 코드를 실행시켜 볼 수는 있지만 실제 해킹 실습까지 해보는 것은 어려울 것이라고 생각한다. 우리가 miner가 될 수 없기 때문에ㅠㅠ</p>\n<p>위 코드는 룰랫을 통해 ether를 얻을 수 있는 게임이다.\r\n10 ether를 contract account에 보내고 만약 timestamp가 15의 배수라면 CA에 있는 모든 ether를 가져올 수 있다.</p>\n<p>예를 들어, CA에 300 ether가 쌓여있다고 생각해보자! 2021/12/23 시세로 300 ehter는 14억이 넘는 돈이다. 만약 miner가 timestamp를 조작하는데 드는 비용이 14억보다 적게든다면 조작을 시도해볼만 하다.</p>\n<hr>\n<h2 id=\"어떻게하면-예방할-수-있을까\" style=\"position:relative;\"><a href=\"#%EC%96%B4%EB%96%BB%EA%B2%8C%ED%95%98%EB%A9%B4-%EC%98%88%EB%B0%A9%ED%95%A0-%EC%88%98-%EC%9E%88%EC%9D%84%EA%B9%8C\" aria-label=\"어떻게하면 예방할 수 있을까 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>어떻게하면 예방할 수 있을까?</h2>\n<p>block.timstamp는 블록생성 시간이 필요할 때만 사용하면 된다. random이나 block.timestamp가 들어가 조건에 의해서 ether가 또는 데이터가 보내져서는 안된다.</p>\n<p>block.timestamp와 마찬가지로 <strong>now</strong>, <strong>block.hash</strong> 의 사용도 되도록 피하는 것이 좋다.</p>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#blocktimestamp%EB%9E%80\">block.timestamp란?</a></li>\n<li><a href=\"#%EC%99%9C-%EC%B7%A8%EC%95%BD%EC%A0%90-%EC%8B%9C%EB%A6%AC%EC%A6%88%EC%97%90-%EB%93%A4%EC%96%B4%EA%B0%94%EC%9D%84%EA%B9%8C\">왜 취약점 시리즈에 들어갔을까?</a></li>\n<li><a href=\"#example-code\">Example code</a></li>\n<li><a href=\"#%EC%96%B4%EB%96%BB%EA%B2%8C%ED%95%98%EB%A9%B4-%EC%98%88%EB%B0%A9%ED%95%A0-%EC%88%98-%EC%9E%88%EC%9D%84%EA%B9%8C\">어떻게하면 예방할 수 있을까?</a></li>\n</ul>\n</div>","frontmatter":{"date":"December 22, 2021","title":"(취약점 시리즈 3) block.timestamp","categories":"취약점분석","author":"한성원","emoji":"🧢"},"fields":{"slug":"/smart_contract/block_timestamp/"}},"prev":null,"site":{"siteMetadata":{"siteUrl":"https://holyhansss.github.io","comments":{"utterances":{"repo":""}}}}},"pageContext":{"slug":"/smart_contract/delegate_call/","nextSlug":"/smart_contract/block_timestamp/","prevSlug":""}},
    "staticQueryHashes": ["1073350324","1956554647","2938748437"]}