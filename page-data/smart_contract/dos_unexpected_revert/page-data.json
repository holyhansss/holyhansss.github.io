{
    "componentChunkName": "component---src-templates-blog-template-js",
    "path": "/smart_contract/dos_unexpected_revert/",
    "result": {"data":{"cur":{"id":"8c6cd84c-58f1-5717-8923-6db335b41fff","html":"<h1 id=\"-unexpected-revert\" style=\"position:relative;\"><a href=\"#-unexpected-revert\" aria-label=\" unexpected revert permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>👋 Unexpected Revert</h1>\n<h2 id=\"unexpected-revert란\" style=\"position:relative;\"><a href=\"#unexpected-revert%EB%9E%80\" aria-label=\"unexpected revert란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Unexpected Revert란?</h2>\n<p>Unexpected Revert는 이름에서 알 수 있듯이, 트랜잭션을 고의적 revert시킴으로써 스마트 계약이 작동되지 않는 상태로 만드는 취약성입니다.</p>\n<hr>\n<h2 id=\"example-code\" style=\"position:relative;\"><a href=\"#example-code\" aria-label=\"example code permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Example code</h2>\n<div class=\"gatsby-highlight\" data-language=\"solidity\"><pre class=\"language-solidity\"><code class=\"language-solidity\"><span class=\"token keyword\">contract</span> <span class=\"token class-name\">KingOfEther</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token builtin\">address</span> <span class=\"token keyword\">public</span> king<span class=\"token punctuation\">;</span>\r\n    <span class=\"token builtin\">uint</span> <span class=\"token keyword\">public</span> balance<span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">function</span> <span class=\"token function\">claimThrone</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">external</span> <span class=\"token keyword\">payable</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">.</span>value <span class=\"token operator\">></span> balance<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Need to pay more to become the king\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token punctuation\">(</span><span class=\"token builtin\">bool</span> sent<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> king<span class=\"token punctuation\">.</span>call<span class=\"token punctuation\">{</span>value<span class=\"token punctuation\">:</span> balance<span class=\"token punctuation\">}</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span>sent<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Failed to send Ether\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        balance <span class=\"token operator\">=</span> msg<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">;</span>\r\n        king <span class=\"token operator\">=</span> msg<span class=\"token punctuation\">.</span>sender<span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token keyword\">contract</span> <span class=\"token class-name\">Attack</span> <span class=\"token punctuation\">{</span>\r\n    KingOfEther kingOfEther<span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">constructor</span><span class=\"token punctuation\">(</span>KingOfEther _kingOfEther<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        kingOfEther <span class=\"token operator\">=</span> <span class=\"token function\">KingOfEther</span><span class=\"token punctuation\">(</span>_kingOfEther<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token keyword\">function</span> <span class=\"token function\">attack</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">public</span> <span class=\"token keyword\">payable</span> <span class=\"token punctuation\">{</span>\r\n        kingOfEther<span class=\"token punctuation\">.</span>claimThrone<span class=\"token punctuation\">{</span>value<span class=\"token punctuation\">:</span> msg<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">}</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span>\r\n</code></pre></div>\n<p><span style=\"color:grey\">출처: <a href=\"https://solidity-by-example.org/hacks/denial-of-service/\">https://solidity-by-example.org/hacks/denial-of-service/</a></span></p>\n<p>시나리오는 이렇다.</p>\n<ol>\n<li>KingOfEther of Ether Contract가 배포된다.</li>\n<li>처음으로 A가 1 Ether를 claimThrone()에 보냄으로써 King이 된다.</li>\n<li>다음으로 B가 2 Ether를 claimThrone()에 보냄으로써 B가 King으로 바뀐다. King이 바뀌기 전에 A에게 1 Ether를 refund 해준다.</li>\n<li>C가 KingOfEther의 주소와 함께 Attack contract를 배포한다.</li>\n<li>C는 Attack.attack을 3 Ether와 함꼐 호출한다.</li>\n<li>C는 C는 king이 되고 Attack contract는 ether를 받을 수 없기 때문에 다른 누구도 king이 될 수 없게 된다. 즉 KingOfEhter은 무의미한 contract가 된다.</li>\n</ol>\n<p>EVM이 externally owned accounts와 contract accounts를 구분하지 않는다는 점을 악용한 것 같아보인다.</p>\n<hr>\n<h2 id=\"how-to-prevent\" style=\"position:relative;\"><a href=\"#how-to-prevent\" aria-label=\"how to prevent permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>How to prevent?</h2>\n<h4 id=\"pull-over-push\" style=\"position:relative;\"><a href=\"#pull-over-push\" aria-label=\"pull over push permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><strong>pull over push</strong></h4>\n<p>pull over push를 통해 문제를 해결 할 수 있다. pull over push는 contract를 분리함으로써 attacker의 공격을 attacker의 손실로만 처리 할 수 있다. 위의 코드를 pull over push로 바꾸어보았다.</p>\n<div class=\"gatsby-highlight\" data-language=\"solidity\"><pre class=\"language-solidity\"><code class=\"language-solidity\"><span class=\"token keyword\">contract</span> <span class=\"token class-name\">KingOfEther</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token builtin\">address</span> <span class=\"token keyword\">public</span> king<span class=\"token punctuation\">;</span>\r\n    <span class=\"token builtin\">uint</span> <span class=\"token keyword\">public</span> balance<span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">mapping</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">address</span> <span class=\"token operator\">=></span> <span class=\"token builtin\">uint</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">public</span> balances<span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">function</span> <span class=\"token function\">claimThrone</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">external</span> <span class=\"token keyword\">payable</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">.</span>value <span class=\"token operator\">></span> balance<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Need to pay more to become the king\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        balances<span class=\"token punctuation\">[</span>king<span class=\"token punctuation\">]</span> <span class=\"token operator\">+=</span> balance<span class=\"token punctuation\">;</span>\r\n\r\n        balance <span class=\"token operator\">=</span> msg<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">;</span>\r\n        king <span class=\"token operator\">=</span> msg<span class=\"token punctuation\">.</span>sender<span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token keyword\">function</span> <span class=\"token function\">withdraw</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">public</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">.</span>sender <span class=\"token operator\">!=</span> king<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Current king cannot withdraw\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token builtin\">uint</span> amount <span class=\"token operator\">=</span> balances<span class=\"token punctuation\">[</span>msg<span class=\"token punctuation\">.</span>sender<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n        balances<span class=\"token punctuation\">[</span>msg<span class=\"token punctuation\">.</span>sender<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token punctuation\">(</span><span class=\"token builtin\">bool</span> sent<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> msg<span class=\"token punctuation\">.</span>sender<span class=\"token punctuation\">.</span>call<span class=\"token punctuation\">{</span>value<span class=\"token punctuation\">:</span> amount<span class=\"token punctuation\">}</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span>sent<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Failed to send Ether\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n이 코드는 Example 코드의 <span class=\"token function\">claimThrone</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">function</span>이 <span class=\"token number\">2</span>개의 <span class=\"token keyword\">function</span>으로 나누어 진 것을 볼 수 있다<span class=\"token punctuation\">.</span> 위 코드의 <span class=\"token function\">claimThrone</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>는 king을 바꾸는 용도로만 사용된다<span class=\"token punctuation\">.</span> 그리고 king에서 쫒겨난 사람들은 withdraw 함수를 통해 ether를 다시 가져올 수 있다<span class=\"token punctuation\">.</span>\r\n</code></pre></div>\n<h2 id=\"마무리\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EB%AC%B4%EB%A6%AC\" aria-label=\"마무리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>마무리</h2>\n<p>취약점들에 대해서 공부하면서 나는 EVM에 대해서 알아가야 할 부분이 많다는 생각이 든다. <del>잘안다고 생각했는데ㅋㅋ</del> 갈 길이 멀다!! 꾸준히 공부하자:)</p>\n<hr>\n<h3 id=\"reference\" style=\"position:relative;\"><a href=\"#reference\" aria-label=\"reference permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reference</h3>\n<ul>\n<li><a href=\"https://consensys.github.io/smart-contract-best-practices/known_attacks/#dos-with-unexpected-revert\">https://consensys.github.io/smart-contract-best-practices/known_attacks/#dos-with-unexpected-revert</a></li>\n<li><a href=\"https://solidity-by-example.org/hacks/denial-of-service/\">https://solidity-by-example.org/hacks/denial-of-service/</a></li>\n<li><a href=\"https://consensys.github.io/smart-contract-best-practices/recommendations/#favor-pull-over-push-for-external-calls\">https://consensys.github.io/smart-contract-best-practices/recommendations/#favor-pull-over-push-for-external-calls</a></li>\n</ul>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#unexpected-revert%EB%9E%80\">Unexpected Revert란?</a></p>\n</li>\n<li>\n<p><a href=\"#example-code\">Example code</a></p>\n</li>\n<li>\n<p><a href=\"#how-to-prevent\">How to prevent?</a></p>\n<ul>\n<li>\n<ul>\n<li><a href=\"#pull-over-push\"><strong>pull over push</strong></a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EB%A7%88%EB%AC%B4%EB%A6%AC\">마무리</a></p>\n<ul>\n<li><a href=\"#reference\">Reference</a></li>\n</ul>\n</li>\n</ul>\n</div>","excerpt":"👋 Unexpected Revert Unexpected Revert란? Unexpected Revert는 이름에서 알 수 있듯이, 트랜잭션을 고의적 revert시킴으로써 스마트 계약이 작동되지 않는 상태로 만드는 취약성입니다. Example code 출처: https://solidity-by-example.org/hacks/denial-of-service/ 시나리오는 이렇다. KingOfEther of Ether Contract가 배포된다. 처음으로 A가 1 Ether를 claimThrone()에 보냄으로써 King이 된다. 다음으로 B가 2 Ether를 claimThrone()에 보냄으로써 B가 King으로 바뀐다. King이 바뀌기 전에 A에게 1 Ether를 refund 해준다. C가 KingOfEther의 주소와 함께 Attack contract를 배포한다. C는 Attack.attack을 3 Ether와 함꼐 호출한다. C는 C는 king이 되고 Attack contrac…","frontmatter":{"date":"December 29, 2021","title":"(취약점 시리즈 6) DOS Unexpected Revert","categories":"취약점분석","author":"한성원","emoji":"🧢"},"fields":{"slug":"/smart_contract/dos_unexpected_revert/"}},"next":{"id":"f4831193-d161-5baa-9df6-834b52f57ed6","html":"<h1 id=\"-front-running\" style=\"position:relative;\"><a href=\"#-front-running\" aria-label=\" front running permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>👋 Front Running</h1>\n<h2 id=\"front-running이란\" style=\"position:relative;\"><a href=\"#front-running%EC%9D%B4%EB%9E%80\" aria-label=\"front running이란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Front Running이란?</h2>\n<p>transaction이 포함된 block이 생성되기까지 약간의 시간이 소요된다. 네트워크 참여자들(miners &#x26; full nodes)은 처리되기 전의 transcation을 볼 수 있다. 만약 네트워크 참여자가 악의적인 마음을 품는다면 이후에 일어날 transcation을 알 수 있고 이에 대한 정보를 악의적으로 사용할 수 있다.</p>\n<p>즉 front running은 block이 채굴되기 전 transcation을 확인해 자신이 더 높은 값의 gas price를 지불하여 이득을 취하는 것이다.</p>\n<p>예시를 본다면 더 이해가 잘 될 것이다.</p>\n<hr>\n<h2 id=\"example-code\" style=\"position:relative;\"><a href=\"#example-code\" aria-label=\"example code permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Example Code</h2>\n<div class=\"gatsby-highlight\" data-language=\"solidity\"><pre class=\"language-solidity\"><code class=\"language-solidity\"><span class=\"token keyword\">contract</span> <span class=\"token class-name\">FindThisHash</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token builtin\">bytes32</span> <span class=\"token keyword\">public</span> <span class=\"token keyword\">constant</span> hash <span class=\"token operator\">=</span>\r\n        <span class=\"token number\">0x564ccaf7594d66b1eaaea24fe01f0585bf52ee70852af4eac0cc4b04711cd0e2</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// hash of \"Ethereum\"</span>\r\n\r\n    <span class=\"token keyword\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">payable</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token keyword\">function</span> <span class=\"token function\">solve</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">string</span> <span class=\"token keyword\">memory</span> solution<span class=\"token punctuation\">)</span> <span class=\"token keyword\">public</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span>hash <span class=\"token operator\">==</span> <span class=\"token function\">keccak256</span><span class=\"token punctuation\">(</span>abi<span class=\"token punctuation\">.</span><span class=\"token function\">encodePacked</span><span class=\"token punctuation\">(</span>solution<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Incorrect answer\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token punctuation\">(</span><span class=\"token builtin\">bool</span> sent<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> msg<span class=\"token punctuation\">.</span>sender<span class=\"token punctuation\">.</span>call<span class=\"token punctuation\">{</span>value<span class=\"token punctuation\">:</span> <span class=\"token number\">10</span> ether<span class=\"token punctuation\">}</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span>sent<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Failed to send Ether\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이 코드는 간단한 추측 게임 코드이다.\r\nhash 값의 변환 전 단어 맞출시 10 ether를 contract에 있는 10 ether를 가져갈 수 있다.</p>\n<p>시나리오는 이렇다.</p>\n<ol>\n<li>A가 FindThisHash contract를 10 ether를 포함해 배포한다.</li>\n<li>B가 hash의 변환 전 단어를 찾는다.(“Ethereum”)</li>\n<li>B는 찾은 답을 매개변수로 하여 solve function을 call한다. Call 할때 gas price 15 gwei로 지정한다.</li>\n<li>C는 transcation pool 보고있다가 누군가 FindThisHash contract의 문제를 풀었고 solve function을 콜한 것을 볼 수있다.</li>\n<li>C는 얻는 정보를 토대로 같은 답을 써서 transaction을 보낸다. 이때 B가 보낸 gas price보다 높은 100gwei를 지불한다.</li>\n<li>C의 transaction이 먼저 채굴되고 C가 보상을 획득하게 된다.</li>\n</ol>\n<p>위에 시나리오처럼 transaction data를 미리 알면 악의적으로 이득을 취할 수 있다.</p>\n<hr>\n<h2 id=\"real-world-example-synthetix\" style=\"position:relative;\"><a href=\"#real-world-example-synthetix\" aria-label=\"real world example synthetix permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Real World Example (Synthetix)</h2>\n<p>Synthetix는 탈중앙화 거래소 중 하나이다. Synthetix는 다른 탈중앙화 거래소와 다르게 독득한 특징을 가지고 있다. Order book을 통해서 거래되는 것이 아닌 Exchange Rates에 의존해서 모든 매수/매도를 통해 가격이 결정된다.\r\n만약 trader가 Exchange Rate가 업데이트 되기 전에 곧 업데이트 될 값을 알 수 있다면 어떻게 될까?\r\n바뀔 Exchange Rate을 안다는 것은 매수가/매도가를 미리 알 수 있다는 말과 같다. 바뀔 매수가/매도가를 미리 알면 상승할 토큰을 미리 사두어 수익을 실현 할 수 있다. 마찬가지로 하락할 토큰을 미리 팔아 손해를 최소화 할 수 있게된다.</p>\n<p>위에서 보았던 Example Code의 시나리오처럼 Synthetix에서도 자금 탈취가 일어났었다. 한 사용자가 Trading bot을 구축해 Exchange Rate을 미리보고 이득을 취하고 있었다.</p>\n<h2 id=\"how-to-prevent\" style=\"position:relative;\"><a href=\"#how-to-prevent\" aria-label=\"how to prevent permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>How to prevent?</h2>\n<ol>\n<li>submarine send</li>\n</ol>\n<p>submarine send을 사용하면 채굴자 또는 네트워크 참여자가 transaction을 미리 볼 수 없게 된다. 관련 없는 transaction과 섞여있다가 나중에 상호작용 있던 smart contract 다시 상호작용 할 수 있게 된다. 이는 이미 악의적인 사용자가 front running하기 늦은 상황이 됨으로 attack을 방어할 수 있다.</p>\n<p>기존의 transaction은 밑에 사진처럼 user와 smart contract이 직접 상호작용 할 수  있다.\r\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABbUlEQVQoz22RTStEURjH7wey8REsZuErEFE2yoZYSLJQWIoyJTsLooYS8tYkQoTUGDNm7ngZb2HmMufeO2fGPfene4aJeOp0/s95zvPrOedvAJiJGHNTYxztbAUpvu/r9Te+zoJ6sCsJtgllq9pn2IV3uhrraaqroSVUS/z0UBeV5/2Bf2udyRdEKow460Ucd1J+2dV3jMt4jMm+Zm42xpkZbGVraV4XPO/j15QVHQCVBqpMmKerNXK2S3R5nNv1NlA5jFQywdxIB5gRouFuoiuLGuA4DqVSiXw+jxBCayklUhYpf/h48X7ymR1sF9ZWI1ytNEDxEiP3+spAa4jsQh+j7SH2tzerEwZhWRau6/54sqroxwj27jDW/RnZkwmckx7wixhB48PRIrm9aZ4OZnHenv81pqq//tB1BMXMNOK4B3k+ROkthafA0AYAsaRJwZEVQ5T6Bfppyjc0lTY5vzC5y16TSKaJJ9KIwjufe78AoAZMVN0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"flow_without_submarine\"\n        title=\"flow_without_submarine\"\n        src=\"/static/9c9f8eaa6681dbde810a0dd4bfaf5b17/37523/flow_without_submarine.png\"\n        srcset=\"/static/9c9f8eaa6681dbde810a0dd4bfaf5b17/e9ff0/flow_without_submarine.png 180w,\n/static/9c9f8eaa6681dbde810a0dd4bfaf5b17/f21e7/flow_without_submarine.png 360w,\n/static/9c9f8eaa6681dbde810a0dd4bfaf5b17/37523/flow_without_submarine.png 720w,\n/static/9c9f8eaa6681dbde810a0dd4bfaf5b17/0955e/flow_without_submarine.png 901w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\r\nsubmarine send를 이용하면 commit-reveal scheme을 활용하여 transaction을 감추 수 있다(정보를 감추기 위해 private &#x26; public key를 사용한다).\r\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77.77777777777777%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAACmUlEQVQ4y52Ta0sUYRiG97dE/6H+Q30Jw/oQ1ZcOBGEgGWaBBwQtSnElMQuxBMMKLMwyM7Ckg+fTuu46q7ub7XlWd2d2Z2Z3Zq7Y2QO7qQQ98PIO8zzvfd/PyUaZmaZp3UbhFmIh+uemeLX6k4SSrvAdZra/fximYd2O8A4XX/dydrib6mE7DRPDpDJaBfE/AXOBRUD793GqBzq5OtTHlR679T3tc+dJDeM/AH985NSDVs41t3HmViMnHzbxddtp+XTDOFTlvpT1AruwG+HSyFOq+u9zoqeF+reDZAtkxr9SzrFZ6gpge4kEkWCI2U0nXRNveDL5DqewiRiNIslyKe3iu3IM20HSJUliUxAIB4KEfwfYjcbw+3x4PB6SyeS++HIMG5hIUhKPICAIAj6fj0gkUtHxcstms4TDYevEYjFSslSpsBSoGySTErIsoapq6RQDFUWxwGRZxuv14vVuEwhGSMrFUcqT2/bEKGPDA3wefYmmKiUVObBy5pzlQCtGxkyC4gUzW4q1dTXVcvr4UaqOHeHF4w7LkU6nK2pTXiNFSaOboMfnSDvbUZfrSK03YyiBvMLuhsvMDzUx3V9Pb+tNsrp+4OAWp0A3IJsKojma2QoKREJuxp9fI7V6Lw/4rK0Wbb4fceoRg52NZLI6mUyGeDxuNUcURaLRKKlUCk1TUTNg7C6hrdwmEo4T391jZLAZefYGmCq2lpoLzPRd5337eeyt9SVFuQ663W42Njbw+/2lmuanP0Fm6S7i/Bii6MX1qQ7N1ZlXuD0zSmiym50PHfxa/ZIfF10/cAusWpoGuYIYe2toK3dQF2vA04GpiZjFTXE4XWx5/RWLX6xZ+UYUmyPGYswtrOBcX8Ox9I2FxWUc6y5UVeEPI5SirXE6wasAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"flow_with_submarine\"\n        title=\"flow_with_submarine\"\n        src=\"/static/fe9f671a96dfd24022283809e3b232ad/37523/flow_with_submarine.png\"\n        srcset=\"/static/fe9f671a96dfd24022283809e3b232ad/e9ff0/flow_with_submarine.png 180w,\n/static/fe9f671a96dfd24022283809e3b232ad/f21e7/flow_with_submarine.png 360w,\n/static/fe9f671a96dfd24022283809e3b232ad/37523/flow_with_submarine.png 720w,\n/static/fe9f671a96dfd24022283809e3b232ad/c4b7c/flow_with_submarine.png 903w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<hr>\n<h2 id=\"마무리\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EB%AC%B4%EB%A6%AC\" aria-label=\"마무리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>마무리</h2>\n<p>smart contract 자체에서 문제보다 블록체인이 가진 특성을 이용하는 공격이다. 이를 좀 더 자세히 이해하기 위해서는 블록체인 자체에 대한 공부가 더 필요할 것이라고 생각한다. smart contract와 더불어 블록체인 코어에도 익숙해져보자!</p>\n<hr>\n<h3 id=\"reference\" style=\"position:relative;\"><a href=\"#reference\" aria-label=\"reference permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reference</h3>\n<ul>\n<li><a href=\"https://solidity-by-example.org/hacks/front-running/\">https://solidity-by-example.org/hacks/front-running/</a></li>\n<li><span style=\"color:grey\"> <a href=\"https://medium.com/haechi-audit-kr/synthetix-front-running-explained-c0d638982cb1\">https://medium.com/haechi-audit-kr/synthetix-front-running-explained-c0d638982cb1</a> </span></li>\n<li><a href=\"https://libsubmarine.org/\">https://libsubmarine.org/</a></li>\n</ul>\n<hr>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#front-running%EC%9D%B4%EB%9E%80\">Front Running이란?</a></p>\n</li>\n<li>\n<p><a href=\"#example-code\">Example Code</a></p>\n</li>\n<li>\n<p><a href=\"#real-world-example-synthetix\">Real World Example (Synthetix)</a></p>\n</li>\n<li>\n<p><a href=\"#how-to-prevent\">How to prevent?</a></p>\n</li>\n<li>\n<p><a href=\"#%EB%A7%88%EB%AC%B4%EB%A6%AC\">마무리</a></p>\n<ul>\n<li><a href=\"#reference\">Reference</a></li>\n</ul>\n</li>\n</ul>\n</div>","frontmatter":{"date":"December 27, 2021","title":"(취약점 시리즈 5) Front Running","categories":"취약점분석","author":"한성원","emoji":"🧢"},"fields":{"slug":"/smart_contract/front_running/"}},"prev":null,"site":{"siteMetadata":{"siteUrl":"https://holyhansss.github.io","comments":{"utterances":{"repo":""}}}}},"pageContext":{"slug":"/smart_contract/dos_unexpected_revert/","nextSlug":"/smart_contract/front_running/","prevSlug":""}},
    "staticQueryHashes": ["1073350324","1956554647","2938748437"]}