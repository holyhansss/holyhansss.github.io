{
    "componentChunkName": "component---src-templates-blog-template-js",
    "path": "/ethernauts/1_fallback_ethernauts/1_fallback_ethernauts/",
    "result": {"data":{"cur":{"id":"fb9c5327-00bd-577e-aeb4-3402a45f6026","html":"<h1 id=\"-1-fallback\" style=\"position:relative;\"><a href=\"#-1-fallback\" aria-label=\" 1 fallback permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>👋 1. Fallback</h1>\n<p><strong>Difficulty 1/10</strong></p>\n<p>직접 푼 Ethernauts 풀이를 적어보려고 한다. 취약점에 공부했던 취약점을 실제로 공격해보며 복습 및 실습을 해볼수 있어 좋은 것 같다.</p>\n<ul>\n<li>승리 조건</li>\n<li>코드 분석</li>\n<li>풀이</li>\n</ul>\n<p>순서로 진행 될 것이다.</p>\n<hr>\n<h2 id=\"승리-조건\" style=\"position:relative;\"><a href=\"#%EC%8A%B9%EB%A6%AC-%EC%A1%B0%EA%B1%B4\" aria-label=\"승리 조건 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>승리 조건</h2>\n<ul>\n<li>contract의 ownership을 뺐어오기</li>\n<li>contract의 balance를 0으로 만들기</li>\n</ul>\n<hr>\n<h2 id=\"코드-분석\" style=\"position:relative;\"><a href=\"#%EC%BD%94%EB%93%9C-%EB%B6%84%EC%84%9D\" aria-label=\"코드 분석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>코드 분석</h2>\n<p>분석은 주석에!</p>\n<div class=\"gatsby-highlight\" data-language=\"solidity\"><pre class=\"language-solidity\"><code class=\"language-solidity\"><span class=\"token comment\">// SPDX-License-Identifier: MIT</span>\r\n<span class=\"token keyword\">pragma</span> <span class=\"token keyword\">solidity</span> <span class=\"token operator\">^</span><span class=\"token version number\">0.6.0</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">import</span> <span class=\"token string\">'@openzeppelin/contracts/math/SafeMath.sol'</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">contract</span> <span class=\"token class-name\">Fallback</span> <span class=\"token punctuation\">{</span>\r\n\r\n    <span class=\"token keyword\">using</span> <span class=\"token class-name\">SafeMath</span> <span class=\"token keyword\">for</span> <span class=\"token builtin\">uint256</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token comment\">// 각각의 address당 ether 기여도(contribution)</span>\r\n    <span class=\"token keyword\">mapping</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">address</span> <span class=\"token operator\">=></span> <span class=\"token builtin\">uint</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">public</span> contributions<span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token comment\">// Fallback Contract의 owner address</span>\r\n    <span class=\"token builtin\">address</span> <span class=\"token keyword\">payable</span> <span class=\"token keyword\">public</span> owner<span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token comment\">//constructor</span>\r\n    <span class=\"token keyword\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">public</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token comment\">// Deployer를 owner로 설정</span>\r\n        owner <span class=\"token operator\">=</span> msg<span class=\"token punctuation\">.</span>sender<span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token comment\">// Deployer의 기여도를 1000 ether로 설정</span>\r\n        contributions<span class=\"token punctuation\">[</span>msg<span class=\"token punctuation\">.</span>sender<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">1000</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> ether<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token comment\">//Owner만 사용할 수 있게하는 modifier</span>\r\n    <span class=\"token keyword\">modifier</span> onlyOwner <span class=\"token punctuation\">{</span>\r\n            <span class=\"token comment\">// msg.sender가 owner인지 아닌지 확인</span>\r\n            <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span>\r\n                msg<span class=\"token punctuation\">.</span>sender <span class=\"token operator\">==</span> owner<span class=\"token punctuation\">,</span>\r\n                <span class=\"token string\">\"caller is not the owner\"</span>\r\n            <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token keyword\">_</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token comment\">//contract의 기여도를 올릴 수 있는 function이다.</span>\r\n    <span class=\"token comment\">//payable로 선언되어 ether를 전송하고 받을 수 있다.</span>\r\n    <span class=\"token keyword\">function</span> <span class=\"token function\">contribute</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">public</span> <span class=\"token keyword\">payable</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token comment\">//msg.sender가 보낸 ether의 양이 0.001 이하인지 확인</span>\r\n        <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">.</span>value <span class=\"token operator\">&lt;</span> <span class=\"token number\">0.001</span> ether<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token comment\">//msg.sender의 기여도(contributions)를 msg.value만큼 올린다.</span>\r\n        contributions<span class=\"token punctuation\">[</span>msg<span class=\"token punctuation\">.</span>sender<span class=\"token punctuation\">]</span> <span class=\"token operator\">+=</span> msg<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token comment\">//만약 msg.sender의 contributions가 owner의 contributions보다 크다면 ownership이 transfer된다.</span>\r\n        <span class=\"token comment\">//초기에 owner의 contributions은 1000 ether이기 때문에 ownership을 바꾸기 위해서는 1000 ether이상의 기여해야한다.</span>\r\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>contributions<span class=\"token punctuation\">[</span>msg<span class=\"token punctuation\">.</span>sender<span class=\"token punctuation\">]</span> <span class=\"token operator\">></span> contributions<span class=\"token punctuation\">[</span>owner<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        owner <span class=\"token operator\">=</span> msg<span class=\"token punctuation\">.</span>sender<span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token comment\">//기여도를 확인할 수 있는 view function</span>\r\n    <span class=\"token keyword\">function</span> <span class=\"token function\">getContribution</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">public</span> <span class=\"token keyword\">view</span> <span class=\"token keyword\">returns</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">uint</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token comment\">//msg.sender의 기여도를 return 한다.</span>\r\n        <span class=\"token keyword\">return</span> contributions<span class=\"token punctuation\">[</span>msg<span class=\"token punctuation\">.</span>sender<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token comment\">//contract가 가지고 있는 모든 balance(ether)를 owner에게 전송한다.</span>\r\n    <span class=\"token keyword\">function</span> <span class=\"token function\">withdraw</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">public</span> onlyOwner <span class=\"token punctuation\">{</span>\r\n        owner<span class=\"token punctuation\">.</span><span class=\"token function\">transfer</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">address</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>balance<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token comment\">//payable로 선언되어 ether를 전송하고 받을 수 있다.</span>\r\n    <span class=\"token comment\">//receive function</span>\r\n    <span class=\"token function\">receive</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">external</span> <span class=\"token keyword\">payable</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token comment\">//msg.sender의 msg.value가 0보다 크고 기여도(contributions)가 0보다 큰지 확인한다</span>\r\n        <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">.</span>value <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token operator\">&amp;&amp;</span> contributions<span class=\"token punctuation\">[</span>msg<span class=\"token punctuation\">.</span>sender<span class=\"token punctuation\">]</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token comment\">//owner를 msg.sender로 바꾼다.</span>\r\n        owner <span class=\"token operator\">=</span> msg<span class=\"token punctuation\">.</span>sender<span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<hr>\n<h2 id=\"풀이\" style=\"position:relative;\"><a href=\"#%ED%92%80%EC%9D%B4\" aria-label=\"풀이 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>풀이</h2>\n<p>우리는 2가지의 문제를 풀어야 한다.</p>\n<ol>\n<li>contract의 ownership을 뺐어오기</li>\n<li>contract의 balance를 0으로 만들기</li>\n</ol>\n<p>차례차례 풀어보겠다.\r\n코드를 봤을 떄 contract의 ownership을 가져올 수 있는 방법은 2가지가 있다.</p>\n<ul>\n<li>contribute()</li>\n<li>receive()</li>\n</ul>\n<ol>\n<li>contribute()를 이용해 owner가 되려면 초기 owner의 contributions 1000 ether보다 더 큰 돈을 contract로 보내야 한다.</li>\n<li>하지만 contribute()의 require을 보면 한번에 0.001 ether이하의 ether만 보낼 수 있게 되어있다. contract에서 의도한대로 owner가 되려면 <strong>1,000,000 + a</strong> 번 전송해야한다.</li>\n<li>이 방법은 비용도 많이들고 엄청난 시간이 걸리기 때문에 receive 함수를 확인해보자!</li>\n<li>receive 함수를 보면 msg.value나 0보다 크고 contributions가 0보다 크면 owner를 msg.sender로 바꿀 수 있다.</li>\n<li>그렇다면 contribute() 호출해 작은 값을 보내어 contributions를 0을 초과하게 만든다음 receive함수를 호출하면 owner를 가져올 수 있다.</li>\n</ol>\n<p>모든 코드는 console창에서 이루어진다.\r\nctrl + shift + i를 눌러 console창을 활성화 시키자</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//0.001보다 작은 0.0001을 보낸다.</span>\r\n<span class=\"token keyword\">await</span> contract<span class=\"token punctuation\">.</span>contribute<span class=\"token punctuation\">.</span><span class=\"token function\">sendTransaction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>value<span class=\"token operator\">:</span><span class=\"token function\">toWei</span><span class=\"token punctuation\">(</span><span class=\"token string\">'0.0001'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token comment\">//나의 contribution을 확인한다.</span>\r\n<span class=\"token function\">fromWei</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">await</span> contract<span class=\"token punctuation\">.</span><span class=\"token function\">getContribution</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token comment\">//contract의 balance를 확인한다.</span>\r\n<span class=\"token keyword\">await</span> <span class=\"token function\">getBalance</span><span class=\"token punctuation\">(</span>instance<span class=\"token punctuation\">)</span>\r\n<span class=\"token comment\">//모두 0.0001과 같을 것이다!</span>\r\n\r\n<span class=\"token comment\">//나의 contribution이 0을 초과했으니 recevice()를 실행 시킬 수 있는 명령어를 실행한다.</span>\r\ncontract<span class=\"token punctuation\">.</span><span class=\"token function\">sendTransaction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>value<span class=\"token operator\">:</span><span class=\"token function\">toWei</span><span class=\"token punctuation\">(</span><span class=\"token string\">'0.0001'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token comment\">//contract의 owner address를 확인한다.</span>\r\n<span class=\"token keyword\">await</span> contract<span class=\"token punctuation\">.</span><span class=\"token function\">owner</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token comment\">//나의 address를 확인한다.</span>\r\nplayer\r\n<span class=\"token comment\">//play(나)이 owner가 된 것을 확인 할 수 있다.</span>\r\n</code></pre></div>\n<p>이렇게 ownership을 가져올 수 있었다.</p>\n<p>다음으로 contract의 balance를 0으로 만들기이다.\r\ncontract의 balance를 0을로 만들기는 매우 쉽다!\r\nowner만 call할 수 있는 함수인 withdraw을 call하기만 하면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//withdraw한다.</span>\r\n<span class=\"token keyword\">await</span> contract<span class=\"token punctuation\">.</span><span class=\"token function\">withdraw</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n\r\n<span class=\"token comment\">//contract의 balance가 0이 된것을 확인한다.</span>\r\n<span class=\"token keyword\">await</span> <span class=\"token function\">getBalance</span><span class=\"token punctuation\">(</span>instance<span class=\"token punctuation\">)</span></code></pre></div>\n<p>Submit instance를 누르고 조금 기다리면 block이 mine되고, 다음과 같이 뜨면서 다음 level로 넘어갈 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABJ0AAASdAHeZh94AAACfklEQVQ4y1WTiY7jNhBE/f/fFSBAkGMm4x2P14csWfdFirRknf0CUd5kI6BR7KJUeA1Su9Oh4nRQ3L2GKDD4l4bLUbkKfYN31jS6Z32WRZwWpsfLH9yKB5fUOq0fA9M0sbvdevxg4B4ORPGAf++5XHuuXk+UDPhBj7EzICzL4rQ0Pdf8gVc8XHBQtpS2Z5pGdn/uhb++Cfuj8HUR3g/Cb+8Lv38Ih7Pw9imUSl6BG2FYdbz7mo9A8+YrvoUNsXpuhOcUThmENcQKggq8Aq7F5t1KaLr/B64097LlXrWOcF3rdtgIL2bAsyM3O3F/TFztyLEZOZnx396MC8h/gXnz5HtiOKeWU2q5Zpa86TfCTwk4SMh3ibhKylEiPsRnLz4XSfmSkFrsCsgiiwuM686N+Rk17O+aY2zI9GvkTG7k4pGLTyUxpdzJ5UYiZ6drryShE8MLkMr27iDWkdcTXlX9GFnPH5j5gJn/Rs9v2PmImv+gmn+lnH7Bznv0/I6Zj8jcrJeHVD8d3VdsOESGU2Kc5wgZLzD5MH7B5CFT+OqPMJ0R59+ct0weSEFlOvyidZSOsGxRP+6h9BXS12yqtvXQvPoKaWNkWD3tir5At08i1ROrjqjuSPQT3Y6vQBUjOkZUuGkVILbYtPKR/IwUHqITt4+OsXlCqVuqx+D+msoOtP38CmwKxFSIyhBbI02JdHbzTL3VuvfqeSi6KqepFcZ2NN2I6Ub6acFay050sYWsutZPH0u1UuVIESHlOkUOVtFkKfHlSpKUbtz1ypjnRNM07CRNkSxH4gRJUiTNkCxDqgoJIyTPkSBAgjvruxQFY5rz9AKepaIbJp7DzLSIC/wHAO0qYjzyzD0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"fallback finish\"\n        title=\"fallback finish\"\n        src=\"/static/68592aa21598d925b557a56b988fc3bf/37523/fallback_finish.png\"\n        srcset=\"/static/68592aa21598d925b557a56b988fc3bf/e9ff0/fallback_finish.png 180w,\n/static/68592aa21598d925b557a56b988fc3bf/f21e7/fallback_finish.png 360w,\n/static/68592aa21598d925b557a56b988fc3bf/37523/fallback_finish.png 720w,\n/static/68592aa21598d925b557a56b988fc3bf/4b446/fallback_finish.png 877w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<hr>\n<h2 id=\"마무리\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EB%AC%B4%EB%A6%AC\" aria-label=\"마무리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>마무리</h2>\n<p>얼마전에 공부했던 king of Ether(DOS with unexpected revert)가 생각난다. revert를 통해 하는 ownership을 가져오는건 아니었지만 비슷한 점이 많은 것 같았다. 고작 1단계를 완료한 것이지만 게임을 통해 배우니 더 재밌는 것 같다. 앞으로도 화이팅!</p>\n<hr>\n<h2 id=\"기타-정보\" style=\"position:relative;\"><a href=\"#%EA%B8%B0%ED%83%80-%EC%A0%95%EB%B3%B4\" aria-label=\"기타 정보 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>기타 정보</h2>\n<ul>\n<li>rinkeyb network ether faucet: <a href=\"https://faucets.chain.link/rinkeby\">https://faucets.chain.link/rinkeby</a></li>\n<li>ethernaut: <a href=\"https://ethernaut.openzeppelin.com/\">https://ethernaut.openzeppelin.com/</a></li>\n</ul>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#%EC%8A%B9%EB%A6%AC-%EC%A1%B0%EA%B1%B4\">승리 조건</a></li>\n<li><a href=\"#%EC%BD%94%EB%93%9C-%EB%B6%84%EC%84%9D\">코드 분석</a></li>\n<li><a href=\"#%ED%92%80%EC%9D%B4\">풀이</a></li>\n<li><a href=\"#%EB%A7%88%EB%AC%B4%EB%A6%AC\">마무리</a></li>\n<li><a href=\"#%EA%B8%B0%ED%83%80-%EC%A0%95%EB%B3%B4\">기타 정보</a></li>\n</ul>\n</div>","excerpt":"👋 1. Fallback Difficulty 1/10 직접 푼 Ethernauts 풀이를 적어보려고 한다. 취약점에 공부했던 취약점을 실제로 공격해보며 복습 및 실습을 해볼수 있어 좋은 것 같다. 승리 조건 코드 분석 풀이 순서로 진행 될 것이다. 승리 조건 contract의 ownership을 뺐어오기 contract의 balance를 0으로 만들기 코드 분석 분석은 주석에! 풀이 우리는 2가지의 문제를 풀어야 한다. contract의 ownership을 뺐어오기 contract의 balance를 0으로 만들기 차례차례 풀어보겠다.\r\n코드를 봤을 떄 contract의 ownership을 가져올 수 있는 방법은 2가지가 있다. contribute() receive() contribute()를 이용해 owner가 되려면 초기 owner의 contributions 1000 ether보다 더 큰 돈을 contract로 보내야 한다. 하지만 contribute()의 require을 보면 …","frontmatter":{"date":"December 22, 2021","title":"(Ethernauts 취약점 공부) 1. Fallback","categories":"취약점분석","author":"한성원","emoji":"🧢"},"fields":{"slug":"/ethernauts/1_fallback_ethernauts/1_fallback_ethernauts/"}},"next":{"id":"957cc097-e5ab-5c01-a410-7e2216f8f744","html":"<h1 id=\"-over--underflow\" style=\"position:relative;\"><a href=\"#-over--underflow\" aria-label=\" over  underflow permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>👋 Over &#x26; UnderFlow</h1>\n<h2 id=\"들어가기-전\" style=\"position:relative;\"><a href=\"#%EB%93%A4%EC%96%B4%EA%B0%80%EA%B8%B0-%EC%A0%84\" aria-label=\"들어가기 전 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>들어가기 전</h2>\n<p>Overflow와 Underflow는 solidity 0.8.0 버전부터 알아서 컨트롤 되게 바뀌었다.\r\n0.8.0 이후 버전을 사용하시는 분은 아래로 내려가도 좋다.</p>\n<hr>\n<h2 id=\"overflow와-underflow란\" style=\"position:relative;\"><a href=\"#overflow%EC%99%80-underflow%EB%9E%80\" aria-label=\"overflow와 underflow란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OverFlow와 UnderFlow란</h2>\n<p>Overflow는 지정된 정수형(int)의 최댓값보다 커졌을 때 발생한다.<br>\nUnderflow는 지정된 정수형(uint)의 최솟값보다 작아졌을 때 발생한다.\r\nSolidity에서는 unsigned Integer(uint)를 자주 사용한다. uint256을 기준으로 했을때 최대값은 2<sup>256</sup>-1이고 최소값은 0이다. 즉 2<sup>256</sup>-1에 1을 더했을때 Overflow 0에서 1을 뺐을때 underflow가 일어날 것이다.</p>\n<p>ExampleColde를 보면 보다 쉽게 이해 할 수 있을 것이다.</p>\n<hr>\n<h2 id=\"example-code\" style=\"position:relative;\"><a href=\"#example-code\" aria-label=\"example code permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Example Code</h2>\n<p>remix IDE에서 실습을 진행한다면 이해가 더욱 빠를것이다!</p>\n<div class=\"gatsby-highlight\" data-language=\"solidity\"><pre class=\"language-solidity\"><code class=\"language-solidity\"><span class=\"token comment\">// SPDX-License-Identifier: MIT</span>\r\n<span class=\"token keyword\">pragma</span> <span class=\"token keyword\">solidity</span> <span class=\"token operator\">^</span><span class=\"token version number\">0.7.0</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 0.8.0 이전 버전이어야함!</span>\r\n\r\n<span class=\"token keyword\">contract</span> <span class=\"token class-name\">OverflowUnderFlow</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token builtin\">int256</span> <span class=\"token keyword\">public</span> zero <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token builtin\">uint256</span> <span class=\"token keyword\">public</span> max <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token operator\">**</span><span class=\"token number\">256</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\r\n    \r\n    <span class=\"token comment\">// zero will end up at 2**256-1</span>\r\n    <span class=\"token keyword\">function</span> <span class=\"token function\">underflow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">public</span> <span class=\"token punctuation\">{</span>\r\n        zero <span class=\"token operator\">-=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n    <span class=\"token comment\">// max will end up at 0</span>\r\n    <span class=\"token keyword\">function</span> <span class=\"token function\">overflow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">public</span> <span class=\"token keyword\">payable</span><span class=\"token punctuation\">{</span>\r\n        max <span class=\"token operator\">+=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><span style=\"color:grey\">출처: <a href=\"https://medium.com/loom-network-korean/%EC%8A%A4%EB%A7%88%ED%8A%B8-%EC%BB%A8%ED%8A%B8%EB%9E%99%ED%8A%B8%EB%A5%BC-%EC%96%B4%EB%96%BB%EA%B2%8C-%EB%B3%B4%ED%98%B8%ED%95%A0-%EA%B2%83%EC%9D%B8%EA%B0%80-%EC%86%94%EB%A6%AC%EB%94%94%ED%8B%B0%EC%9D%98-6%EA%B0%80%EC%A7%80-%EC%B7%A8%EC%95%BD%EC%A0%90-%EB%B0%8F-%EB%8C%80%EB%B9%84%EC%B1%85-1%EB%B6%80-c21d4e37034a\">https://medium.com/loom-network-korean/스마트-컨트랙트를-어떻게-보호할-것인가-솔리디티의-6가지-취약점-및-대비책-1부</a></span></p>\n<p>위 코드는 0.8.0 이전 버전들에게는 위험한 코드이다. zero에서 underflow function을 실행기키면 -1로 바뀌는 것이 아닌 2<sup>256</sup>-1로 바뀌게 된다. 만약 이 코드가 erc20와 같은 토큰을 다루는 코드였다면 큰 손실을 입을수도 있다.\r\nOverflow도 마찬가지로 max(2<sup>256</sup>-1) + 1을 하면 2<sup>256</sup>이 아닌 0으로 바뀌게 된다.</p>\n<hr>\n<h2 id=\"어떻게-overflow와-underflow를-예방할-수-있을까\" style=\"position:relative;\"><a href=\"#%EC%96%B4%EB%96%BB%EA%B2%8C-overflow%EC%99%80-underflow%EB%A5%BC-%EC%98%88%EB%B0%A9%ED%95%A0-%EC%88%98-%EC%9E%88%EC%9D%84%EA%B9%8C\" aria-label=\"어떻게 overflow와 underflow를 예방할 수 있을까 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>어떻게 overflow와 underflow를 예방할 수 있을까?</h2>\n<p>openzeppline의 SafeMath 같은 라이브러리를 사용하는 것이 가능 보편화되어있다.</p>\n<hr>\n<h2 id=\"080-이후-버전에서는-어떻게-다른가\" style=\"position:relative;\"><a href=\"#080-%EC%9D%B4%ED%9B%84-%EB%B2%84%EC%A0%84%EC%97%90%EC%84%9C%EB%8A%94-%EC%96%B4%EB%96%BB%EA%B2%8C-%EB%8B%A4%EB%A5%B8%EA%B0%80\" aria-label=\"080 이후 버전에서는 어떻게 다른가 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>0.8.0 이후 버전에서는 어떻게 다른가?</h2>\n<p>0.8.0 이후 버전에서는 위와 같은 코드를 작성해도 문제가 되지 않는다. 0.8.0 이후 버전은 underflow 또는 overflow가 일어나면 즉시 revert 해버리기 때문이다. 그래서 따로 safe math와 같은 라이브러리를 사용 할 필요가 없다.</p>\n<hr>\n<h2 id=\"마무리\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EB%AC%B4%EB%A6%AC\" aria-label=\"마무리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>마무리</h2>\n<p>overflow와 underflow는 다른 언어를 배우면서 배웠던 것이라 개념 자체는 쉬웠다.\r\n다음 포스트에서는 <strong>짧은 주소 공격</strong> 에 대해서 다루어 볼 예정이다.</p>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#%EB%93%A4%EC%96%B4%EA%B0%80%EA%B8%B0-%EC%A0%84\">들어가기 전</a></li>\n<li><a href=\"#overflow%EC%99%80-underflow%EB%9E%80\">OverFlow와 UnderFlow란</a></li>\n<li><a href=\"#example-code\">Example Code</a></li>\n<li><a href=\"#%EC%96%B4%EB%96%BB%EA%B2%8C-overflow%EC%99%80-underflow%EB%A5%BC-%EC%98%88%EB%B0%A9%ED%95%A0-%EC%88%98-%EC%9E%88%EC%9D%84%EA%B9%8C\">어떻게 overflow와 underflow를 예방할 수 있을까?</a></li>\n<li><a href=\"#080-%EC%9D%B4%ED%9B%84-%EB%B2%84%EC%A0%84%EC%97%90%EC%84%9C%EB%8A%94-%EC%96%B4%EB%96%BB%EA%B2%8C-%EB%8B%A4%EB%A5%B8%EA%B0%80\">0.8.0 이후 버전에서는 어떻게 다른가?</a></li>\n<li><a href=\"#%EB%A7%88%EB%AC%B4%EB%A6%AC\">마무리</a></li>\n</ul>\n</div>","frontmatter":{"date":"December 21, 2021","title":"(취약점 시리즈 2) Over & Under Flow?","categories":"취약점분석","author":"한성원","emoji":"🧢"},"fields":{"slug":"/vulnerability/over_under_flow/over_under_flow/"}},"prev":{"id":"61d64787-9a91-539d-8e79-abcc19096677","html":"<h1 id=\"-blocktimestamp\" style=\"position:relative;\"><a href=\"#-blocktimestamp\" aria-label=\" blocktimestamp permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>👋 block.timestamp</h1>\n<h2 id=\"blocktimestamp란\" style=\"position:relative;\"><a href=\"#blocktimestamp%EB%9E%80\" aria-label=\"blocktimestamp란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>block.timestamp란?</h2>\n<p>block.timestamp는 msg.sender처럼 블록체인에서 제공해주는 global 변수 중 하나이다. 이는 블록 생성 시간을 나타낸다.\r\n블록체인의 timestamp는 생성 시점에 데이터가 존재했다는 사실을 증명해주기 때문에 블록체인 자체에 매우 중요하다.</p>\n<hr>\n<h2 id=\"왜-취약점-시리즈에-들어갔을까\" style=\"position:relative;\"><a href=\"#%EC%99%9C-%EC%B7%A8%EC%95%BD%EC%A0%90-%EC%8B%9C%EB%A6%AC%EC%A6%88%EC%97%90-%EB%93%A4%EC%96%B4%EA%B0%94%EC%9D%84%EA%B9%8C\" aria-label=\"왜 취약점 시리즈에 들어갔을까 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>왜 취약점 시리즈에 들어갔을까?</h2>\n<p>바로 block.timestamp는 채굴자(miner)들에게 영향을 받을 수 있기 때문이다. 즉 block.timestamp를 통해 random을 생성하거나 block.timestamp와 관련해서 접근할 수 있는 함수가 있다면 smart contract에게 좋지 않은 영향을 끼칠 수 있다.</p>\n<hr>\n<h2 id=\"example-code\" style=\"position:relative;\"><a href=\"#example-code\" aria-label=\"example code permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Example code</h2>\n<div class=\"gatsby-highlight\" data-language=\"solidity\"><pre class=\"language-solidity\"><code class=\"language-solidity\"><span class=\"token keyword\">contract</span> <span class=\"token class-name\">Roulette</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token builtin\">uint</span> <span class=\"token keyword\">public</span> pastBlockTime<span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">payable</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token keyword\">function</span> <span class=\"token function\">spin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">external</span> <span class=\"token keyword\">payable</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">.</span>value <span class=\"token operator\">==</span> <span class=\"token number\">10</span> ether<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// must send 10 ether to play</span>\r\n        <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span>block<span class=\"token punctuation\">.</span>timestamp <span class=\"token operator\">!=</span> pastBlockTime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// only 1 transaction per block</span>\r\n\r\n        pastBlockTime <span class=\"token operator\">=</span> block<span class=\"token punctuation\">.</span>timestamp<span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>block<span class=\"token punctuation\">.</span>timestamp <span class=\"token operator\">%</span> <span class=\"token number\">15</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n            <span class=\"token punctuation\">(</span><span class=\"token builtin\">bool</span> sent<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> msg<span class=\"token punctuation\">.</span>sender<span class=\"token punctuation\">.</span>call<span class=\"token punctuation\">{</span>value<span class=\"token punctuation\">:</span> <span class=\"token builtin\">address</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>balance<span class=\"token punctuation\">}</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span>sent<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Failed to send Ether\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n    <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><span style=\"color:grey\">출처: <a href=\"https://solidity-by-example.org/hacks/block-timestamp-manipulation/\">https://solidity-by-example.org/hacks/block-timestamp-manipulation/</a></span></p>\n<p>위 코드를 실행시켜 볼 수는 있지만 실제 해킹 실습까지 해보는 것은 어려울 것이라고 생각한다. 우리가 miner가 될 수 없기 때문에ㅠㅠ</p>\n<p>위 코드는 룰랫을 통해 ether를 얻을 수 있는 게임이다.\r\n10 ether를 contract account에 보내고 만약 timestamp가 15의 배수라면 CA에 있는 모든 ether를 가져올 수 있다.</p>\n<p>예를 들어, CA에 300 ether가 쌓여있다고 생각해보자! 2021/12/23 시세로 300 ehter는 14억이 넘는 돈이다. 만약 miner가 timestamp를 조작하는데 드는 비용이 14억보다 적게든다면 조작을 시도해볼만 하다.</p>\n<hr>\n<h2 id=\"어떻게하면-예방할-수-있을까\" style=\"position:relative;\"><a href=\"#%EC%96%B4%EB%96%BB%EA%B2%8C%ED%95%98%EB%A9%B4-%EC%98%88%EB%B0%A9%ED%95%A0-%EC%88%98-%EC%9E%88%EC%9D%84%EA%B9%8C\" aria-label=\"어떻게하면 예방할 수 있을까 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>어떻게하면 예방할 수 있을까?</h2>\n<p>block.timstamp는 블록생성 시간이 필요할 때만 사용하면 된다. random이나 block.timestamp가 들어가 조건에 의해서 ether가 또는 데이터가 보내져서는 안된다.</p>\n<p>block.timestamp와 마찬가지로 <strong>now</strong>, <strong>block.hash</strong> 의 사용도 되도록 피하는 것이 좋다.</p>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#blocktimestamp%EB%9E%80\">block.timestamp란?</a></li>\n<li><a href=\"#%EC%99%9C-%EC%B7%A8%EC%95%BD%EC%A0%90-%EC%8B%9C%EB%A6%AC%EC%A6%88%EC%97%90-%EB%93%A4%EC%96%B4%EA%B0%94%EC%9D%84%EA%B9%8C\">왜 취약점 시리즈에 들어갔을까?</a></li>\n<li><a href=\"#example-code\">Example code</a></li>\n<li><a href=\"#%EC%96%B4%EB%96%BB%EA%B2%8C%ED%95%98%EB%A9%B4-%EC%98%88%EB%B0%A9%ED%95%A0-%EC%88%98-%EC%9E%88%EC%9D%84%EA%B9%8C\">어떻게하면 예방할 수 있을까?</a></li>\n</ul>\n</div>","frontmatter":{"date":"December 22, 2021","title":"(취약점 시리즈 3) block.timestamp","categories":"취약점분석","author":"한성원","emoji":"🧢"},"fields":{"slug":"/vulnerability/block_timestamp/block_timestamp/"}},"site":{"siteMetadata":{"siteUrl":"https://holyhansss.github.io","comments":{"utterances":{"repo":""}}}}},"pageContext":{"slug":"/ethernauts/1_fallback_ethernauts/1_fallback_ethernauts/","nextSlug":"/vulnerability/over_under_flow/over_under_flow/","prevSlug":"/vulnerability/block_timestamp/block_timestamp/"}},
    "staticQueryHashes": ["1073350324","1956554647","2938748437"]}